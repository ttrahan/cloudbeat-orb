description: >
  Install Oxygen CLI and its dependencies and Selenium Standalone Server.

parameters:
  executor:
    description: executor to use for this job
    type: executor
    default: default
  
  checkout:
    description: >
      Boolean for whether or not to checkout as a first step. Default is true.
    type: boolean
    default: true

  selenium-minor-version:
    description: the minor version of Selenium Standalone Server to use
    type: string
    default: "3.5"

  selenium-patch-version:
    description: the patch version of Selenium Standalone Server to use
    type: string
    default: "3.5.3"

steps:
  - when:
      condition: << parameters.checkout >>
      steps:
        - checkout

  - run:
      name: Install Oxygen CLI
      command: |
        sudo chgrp -R circleci /usr/local/lib/node_modules/
        sudo npm install -g oxygen-cli 

  - run:
      name: Install Mono .Net framework for Ubuntu 16.04
      command: |
        sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 3FA7E0328081BFF6A14DA29AA6A19B38D3D831EF
        sudo apt install apt-transport-https ca-certificates
        echo "deb https://download.mono-project.com/repo/ubuntu stable-xenial main" | sudo tee /etc/apt/sources.list.d/mono-official-stable.list
        sudo apt update 
        sudo apt install mono-devel

  - run:
      name: Install Selenium Standalone Server
      command: |
        curl -O http://selenium-release.storage.googleapis.com/<< parameters.selenium-minor-version >>/selenium-server-standalone-<< parameters.selenium-patch-version >>.jar

  - run:
      name: Run Selenium Standalone Server
      command: |
        java -jar selenium-server-standalone-<< parameters.selenium-patch-version >>.jar -port 4444 -timeout 320 -browserTimeout 320 -log test-reports/selenium.log
      background: true
